# AIÂ DiagramÂ GeneratorÂ ğŸ–¼ï¸ğŸ¤–

Create cloudâ€‘architecture diagrams from naturalâ€‘language prompts via a FastAPI
service powered by **Gemini** (LangChainâ€¯+â€¯LangGraph) and the
[`diagrams`](https://diagrams.mingrammer.com/) Python package.

---

## ProjectÂ layout

```text
ai-diagram-generator/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py            # FastAPI app + routes
â”‚   â”œâ”€â”€ agent.py           # LangGraph agent & prompt logic
â”‚   â”œâ”€â”€ diagram_tool.py    # Diagram generation + Gemini tool
â”‚   â”œâ”€â”€ llm_client.py      # Gemini / HF fallback initialiser
â”‚   â”œâ”€â”€ config.py          # Pydanticâ€‘settings wrapper
â”‚   â””â”€â”€ prompts.py         # (optional) prompt templates
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_api.py
â”‚   â”œâ”€â”€ test_agent.py
â”‚   â””â”€â”€ test_diagram.py
â”œâ”€â”€ outputs/               # PNGs generated at runtime
â”œâ”€â”€ Dockerfile             # Production image
â”œâ”€â”€ docker-compose.yml     # `docker compose up` for local run
â”œâ”€â”€ requirements.txt       # Python deps (NumPyÂ <â€¯2 pin)
â”œâ”€â”€ .env.example           # Copy âœÂ .env and add keys
â””â”€â”€ README.md              # You are here
```

---

## QuickÂ start (local)

```bash
# 1. clone & cd
git clone https://github.com/Orbenson/Engini-Home-Assignment.git
cd Engini-Home-Assignment

# 2. Python 3.10 venv
python3.10 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt

# 3. env vars
cp .env.example .env            # edit GOOGLE_API_KEY=...
export $(cat .env | xargs)      # or rely on pythonâ€‘dotenv autoâ€‘load

# 4. run server
uvicorn src.main:app --reload   # http://127.0.0.1:8000
```

---

## QuickÂ start (Docker)

```bash
docker compose up --build
# API exposed on http://localhost:8000
```

`docker-compose.yml` passes `GOOGLE_API_KEY` from your host environment.
Export it before running or add to an `.env` file that Compose can read.

---

## EnvironmentÂ variables

| Var | Purpose |
|-----|---------|
| `GOOGLE_API_KEY` | **required** for Gemini models |
| `MODEL_NAME`     | default `gemini-2.0-flash-001` |
| `TEMPERATURE`    | defaultÂ 0.3 |
| `FALLBACK_MODEL` | HuggingFace model if Gemini unavailable (`distilgpt2`) |

Copy **.env.example** âœÂ `.env` and fill in the key; `config.py` autoâ€‘loads it.

---

## RESTÂ API

| Method | Path            | Description |
|--------|-----------------|-------------|
| GET    | `/diagram?description=...` | Returns a PNG image generated by keyword heuristics (no LLM). |
| POST   | `/assistant_chat` | Conversational endpoint powered by GeminiÂ +Â LangGraph. |

### POSTÂ /assistant_chat

```jsonc
# request body
{
  "conversation_id": "demo-chat-1",      // optional thread id
  "message": "Design a microservices architecture ..."
}
```

```jsonc
# successful response
{
  "conversation_id": "demo-chat-1",
  "response": "The diagram has been generated and saved to outputs/micro_a1b2c3.png",
  "image_path": "outputs/micro_a1b2c3.png"
}
```

---

## PostmanÂ collection

1. Open Postman â†’ **Import â†’ Raw text**  
2. Paste **CellÂ 1** and **CellÂ 2** below (separately) to create two saved requests.

<details>
<summary>CellÂ 1Â â€”Â GETÂ /diagram</summary>

```json
{
  "info": { "name": "GET /diagram", "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json" },
  "item": [
    {
      "name": "GET /diagram",
      "request": {
        "method": "GET",
        "url": {
          "raw": "http://127.0.0.1:8000/diagram?description=Create%20a%20diagram%20showing%20a%20basic%20web%20application%20with%20an%20Application%20Load%20Balancer%2C%20two%20EC2%20instances%2C%20and%20an%20RDS%20database.",
          "protocol": "http",
          "host": ["127","0","0","1"],
          "port": "8000",
          "path": ["diagram"],
          "query": [
            {
              "key": "description",
              "value": "Create a diagram showing a basic web application with an Application Load Balancer, two EC2 instances, and an RDS database."
            }
          ]
        }
      }
    }
  ]
}
```
</details>

<details>
<summary>CellÂ 2Â â€”Â POSTÂ /assistant_chat</summary>

```json
{
  "info": { "name": "POST /assistant_chat", "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json" },
  "item": [
    {
      "name": "POST /assistant_chat",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"conversation_id\": \"demo-chat-1\",\n  \"message\": \"Design a microservices architecture with three services: authentication, payment, order. Include an API Gateway, an SQS queue, a shared RDS database, and CloudWatch.\" \n}"
        },
        "url": {
          "raw": "http://127.0.0.1:8000/assistant_chat",
          "protocol": "http",
          "host": ["127","0","0","1"],
          "port": "8000",
          "path": ["assistant_chat"]
        }
      }
    }
  ]
}
```
</details>

---

## RunningÂ tests

```bash
# add project root to PYTHONPATH so tests can import src.*
pytest
```

If you prefer automatic path handling, a tiny **pytest.ini** is included:

```ini
[pytest]
pythonpath = .
```

---

## Common issues

| Symptom | Fix |
|---------|-----|
| `ModuleNotFoundError: langchain_google_genai` | `pip install langchain-google-genai` |
| Gemini 400 error about `items` | Tool schema fixed in `diagram_tool.py` (Node/Edge models). |
| `_ARRAY_API not found` from Torch | NumPy pinned `<2` in requirements.txt |

---

## Production build

```bash
docker build -t ai-diagram-generator .
docker run -p 8000:8000 --env GOOGLE_API_KEY=YOUR_KEY ai-diagram-generator
```

---

## License

MIT â€“Â feel free to adapt for your own diagramâ€‘asâ€‘aâ€‘service projects.
